---
repository:
  ${name}-expression:
    patterns:
      - name: support.other.match.any.regexp
        match: \.
      - name: support.other.match.begin.regexp
        match: \^
      - name: support.other.match.end.regexp
        match: \$
      - name: keyword.operator.quantifier.regexp
        match: '[+*?]\??'
      - name: keyword.operator.disjunction.regexp
        match: \|
      - name: keyword.operator.quantifier.regexp
        match: |
          (?x)
            \{(
              \d+ | \d+,(\d+)? | ,\d+
            )\}
      - include: '#escape-sequence'

  backreference-number:
    name: meta.backreference.regexp
    match: (\\[1-9]\d?)
    captures:
      '1': {name: entity.name.tag.backreference.regexp}

  backreference:
    name: meta.backreference.named.regexp
    match: |
      (?x)
        (\()  (\?P= \w+(?:\s+[[:alnum:]]+)?)  (\))
    captures:
      '1': {name: punctuation.parenthesis.backreference.named.begin.regexp
                  support.other.parenthesis.regexp}
      '2': {name: entity.name.tag.named.backreference.regexp}
      '3': {name: punctuation.parenthesis.backreference.named.end.regexp
                  support.other.parenthesis.regexp}

  flags:
    name: storage.modifier.flag.regexp
    match: \(\?[aiLmsux]+\)

  escape-special:
    name: support.other.escape.special.regexp
    match: \\([AbBdDsSwWZ])

  escape-character:
    name: constant.character.escape.regexp
    match: |
      (?x)
        \\ (
              x[0-9A-Fa-f]{2}
              | 0[0-7]{1,2}
              | [0-7]{3}
           )

  escape-unicode:
    name: constant.character.unicode.regexp
    match: |
      (?x)
        \\ (
              u[0-9A-Fa-f]{4}
              | U[0-9A-Fa-f]{8}
           )

  escape-catchall:
    name: constant.character.escape.regexp
    match: \\(.|\n)

  escape-sequence:
    patterns:
      - include: '#escape-special'
      - include: '#escape-character'
      - include: '#escape-unicode'
      - include: '#backreference-number'
      - include: '#escape-catchall'

  charecter-set-escapes:
    patterns:
      - name: constant.character.escape.regexp
        match: \\[abfnrtv\\]
      - include: '#escape-special'
      - name: constant.character.escape.regexp
        match: \\([0-7]{1,3})
      - include: '#escape-character'
      - include: '#escape-unicode'
      - include: '#escape-catchall'
...
